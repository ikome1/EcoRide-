<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test localStorage</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test { margin: 10px 0; padding: 10px; border: 1px solid #ccc; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        button { padding: 10px 20px; margin: 5px; }
    </style>
</head>
<body>
    <h1>Test localStorage</h1>
    
    <div class="test">
        <h3>Actions</h3>
        <button onclick="testLocalStorage()">Tester localStorage</button>
        <button onclick="clearAll()">Vider tout</button>
        <button onclick="showAll()">Afficher tout</button>
    </div>
    
    <div id="results"></div>
    
    <script>
        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `test ${type}`;
            div.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong>: ${message}`;
            results.appendChild(div);
            console.log(message);
        }
        
        function testLocalStorage() {
            log('=== TEST LOCALSTORAGE ===');
            
            // Test 1: Vérifier si localStorage est disponible
            if (typeof Storage === 'undefined') {
                log('❌ localStorage non supporté', 'error');
                return;
            }
            log('✅ localStorage supporté', 'success');
            
            // Test 2: Tester l'écriture
            try {
                localStorage.setItem('test_key', 'test_value');
                log('✅ Écriture dans localStorage réussie', 'success');
            } catch (error) {
                log(`❌ Erreur écriture: ${error.message}`, 'error');
                return;
            }
            
            // Test 3: Tester la lecture
            try {
                const value = localStorage.getItem('test_key');
                if (value === 'test_value') {
                    log('✅ Lecture depuis localStorage réussie', 'success');
                } else {
                    log(`❌ Valeur incorrecte: ${value}`, 'error');
                }
            } catch (error) {
                log(`❌ Erreur lecture: ${error.message}`, 'error');
                return;
            }
            
            // Test 4: Tester JSON
            try {
                const testData = { users: [{ id: 1, name: 'test' }] };
                localStorage.setItem('test_json', JSON.stringify(testData));
                const retrieved = JSON.parse(localStorage.getItem('test_json'));
                if (retrieved.users.length === 1) {
                    log('✅ JSON localStorage fonctionne', 'success');
                } else {
                    log('❌ JSON localStorage ne fonctionne pas', 'error');
                }
            } catch (error) {
                log(`❌ Erreur JSON: ${error.message}`, 'error');
            }
            
            // Test 5: Nettoyer
            localStorage.removeItem('test_key');
            localStorage.removeItem('test_json');
            log('✅ Nettoyage effectué', 'success');
            
            log('=== FIN TEST ===');
        }
        
        function clearAll() {
            try {
                localStorage.clear();
                log('✅ localStorage vidé', 'success');
            } catch (error) {
                log(`❌ Erreur: ${error.message}`, 'error');
            }
        }
        
        function showAll() {
            log('=== CONTENU LOCALSTORAGE ===');
            let hasData = false;
            
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                const value = localStorage.getItem(key);
                log(`Clé: ${key}`, 'info');
                log(`Valeur: ${value.substring(0, 100)}${value.length > 100 ? '...' : ''}`, 'info');
                hasData = true;
            }
            
            if (!hasData) {
                log('Aucune donnée dans localStorage', 'info');
            }
            
            log('=== FIN CONTENU ===');
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            log('Page chargée', 'success');
            showAll();
        });
    </script>
</body>
</html>
