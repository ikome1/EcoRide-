<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inscription Simple</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .form { max-width: 400px; margin: 0 auto; }
        input { width: 100%; padding: 10px; margin: 5px 0; border: 1px solid #ccc; }
        button { width: 100%; padding: 10px; background: #4CAF50; color: white; border: none; cursor: pointer; }
        button:hover { background: #45a049; }
        .error { color: red; margin: 10px 0; }
        .success { color: green; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>Inscription Simple</h1>
    
    <div class="form">
        <input type="text" id="pseudo" placeholder="Pseudo" value="testuser">
        <input type="email" id="email" placeholder="Email" value="test@test.com">
        <input type="password" id="password" placeholder="Mot de passe" value="Test123">
        <button onclick="inscription()">Créer le compte</button>
        
        <div id="message"></div>
    </div>
    
    <script src="js/userManager.js"></script>
    <script>
        function showMessage(text, isError = false) {
            const message = document.getElementById('message');
            message.textContent = text;
            message.className = isError ? 'error' : 'success';
        }
        
        function inscription() {
            console.log('=== DÉBUT INSCRIPTION ===');
            
            const pseudo = document.getElementById('pseudo').value.trim();
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value;
            
            console.log('Données:', { pseudo, email, password });
            
            // Vérifications de base
            if (!pseudo || !email || !password) {
                showMessage('Tous les champs sont obligatoires', true);
                return;
            }
            
            if (password.length < 8) {
                showMessage('Le mot de passe doit faire au moins 8 caractères', true);
                return;
            }
            
            try {
                console.log('Tentative de création...');
                
                // Créer l'utilisateur directement
                const newUser = {
                    id: Date.now(),
                    pseudo: pseudo,
                    email: email,
                    password: btoa(password), // Hash simple
                    credits: 20,
                    role: 'user',
                    type: 'passager',
                    vehicles: [],
                    preferences: { fumeur: false, animaux: false, autres: [] },
                    trips: [],
                    createdAt: new Date().toISOString()
                };
                
                console.log('Utilisateur créé:', newUser);
                
                // Vérifier s'il existe déjà
                const exists = userManager.users.find(u => u.pseudo === pseudo || u.email === email);
                if (exists) {
                    showMessage('Ce pseudo ou email existe déjà', true);
                    return;
                }
                
                // Ajouter à la liste
                userManager.users.push(newUser);
                console.log('Ajouté à la liste. Total:', userManager.users.length);
                
                // Sauvegarder
                const saved = userManager.saveUsers();
                if (!saved) {
                    showMessage('Erreur lors de la sauvegarde', true);
                    return;
                }
                
                console.log('Sauvegarde réussie');
                showMessage('Compte créé avec succès !');
                
                // Vider le formulaire
                document.getElementById('pseudo').value = '';
                document.getElementById('email').value = '';
                document.getElementById('password').value = '';
                
            } catch (error) {
                console.error('Erreur:', error);
                showMessage('Erreur: ' + error.message, true);
            }
            
            console.log('=== FIN INSCRIPTION ===');
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Page chargée');
            
            if (typeof userManager !== 'undefined') {
                console.log('userManager chargé, utilisateurs:', userManager.users.length);
            } else {
                console.error('userManager non chargé');
                showMessage('Erreur: userManager non chargé', true);
            }
        });
    </script>
</body>
</html>
